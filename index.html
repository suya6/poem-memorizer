<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¤è¯—èƒŒè¯µåŠ©æ‰‹</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
      background: #f9f7f0;
      padding: 15px;
      color: #333;
      line-height: 1.6;
    }
    .container { max-width: 600px; margin: 0 auto; }
    .card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    h3 {
      margin-bottom: 15px;
      color: #2c3e50;
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
      color: #555;
    }
    select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    #previewArea {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      margin: 15px 0;
      display: none;
    }
    #previewText {
      white-space: pre-wrap;
      line-height: 1.7;
      color: #333;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    button:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- M1: ç¡®è®¤åŸæ–‡æ¨¡å— -->
    <div class="card">
      <h3>ğŸ“š é€‰æ‹©æˆ–ç²˜è´´è¦èƒŒè¯µçš„å¤æ–‡</h3>
      
      <label>é€‰æ‹©ç¯‡ç›®ï¼š</label>
      <select id="poemSelect">
        <option value="">-- è¯·é€‰æ‹© --</option>
        <option value="æ™‹å¤ªå…ƒä¸­ï¼Œæ­¦é™µäººæ•é±¼ä¸ºä¸šï¼Œç¼˜æºªè¡Œï¼Œå¿˜è·¯ä¹‹è¿œè¿‘ã€‚å¿½é€¢æ¡ƒèŠ±æ—ï¼Œå¤¹å²¸æ•°ç™¾æ­¥ï¼Œä¸­æ— æ‚æ ‘ï¼ŒèŠ³è‰é²œç¾ï¼Œè½è‹±ç¼¤çº·ã€‚æ¸”äººç”šå¼‚ä¹‹ï¼Œå¤å‰è¡Œï¼Œæ¬²ç©·å…¶æ—ã€‚">ã€Šæ¡ƒèŠ±æºè®°ã€‹ï¼ˆèŠ‚é€‰ï¼‰</option>
        <option value="åº†å†å››å¹´æ˜¥ï¼Œæ»•å­äº¬è°ªå®ˆå·´é™µéƒ¡ã€‚è¶Šæ˜å¹´ï¼Œæ”¿é€šäººå’Œï¼Œç™¾åºŸå…·å…´ï¼Œä¹ƒé‡ä¿®å²³é˜³æ¥¼ï¼Œå¢å…¶æ—§åˆ¶ï¼Œåˆ»å”è´¤ä»Šäººè¯—èµ‹äºå…¶ä¸Š...">ã€Šå²³é˜³æ¥¼è®°ã€‹ï¼ˆèŠ‚é€‰ï¼‰</option>
        <option value="äºˆç‹¬çˆ±è²ä¹‹å‡ºæ·¤æ³¥è€Œä¸æŸ“ï¼Œæ¿¯æ¸…æ¶Ÿè€Œä¸å¦–ï¼Œä¸­é€šå¤–ç›´ï¼Œä¸è”“ä¸æï¼Œé¦™è¿œç›Šæ¸…ï¼Œäº­äº­å‡€æ¤...">ã€Šçˆ±è²è¯´ã€‹</option>
        <option value="å±±ä¸åœ¨é«˜ï¼Œæœ‰ä»™åˆ™åã€‚æ°´ä¸åœ¨æ·±ï¼Œæœ‰é¾™åˆ™çµã€‚æ–¯æ˜¯é™‹å®¤ï¼ŒæƒŸå¾å¾·é¦¨...">ã€Šé™‹å®¤é“­ã€‹</option>
        <option value="ä»å°ä¸˜è¥¿è¡Œç™¾äºŒåæ­¥ï¼Œéš”ç¯ç«¹ï¼Œé—»æ°´å£°ï¼Œå¦‚é¸£ç®ç¯ï¼Œå¿ƒä¹ä¹‹...">ã€Šå°çŸ³æ½­è®°ã€‹ï¼ˆèŠ‚é€‰ï¼‰</option>
      </select>

      <label>æˆ–ç²˜è´´åŸæ–‡ï¼š</label>
      <textarea id="manualInput" placeholder="åœ¨æ­¤ç²˜è´´å…¨æ–‡..."></textarea>

      <div id="previewArea">
        <strong>é¢„è§ˆåŸæ–‡ï¼š</strong>
        <div id="previewText"></div>
      </div>

      <button id="confirmBtn" disabled>âœ… ç¡®è®¤åŸæ–‡</button>
    </div>

    <!-- åç»­æ¨¡å—ï¼ˆM2-M6ï¼‰å°†åœ¨è¿™é‡Œæ·»åŠ  -->
  </div>
<script>
  // === å…¨å±€å˜é‡ ===
  window.yuanwen = "";

  // === M1: åŸæ–‡ç¡®è®¤ ===
  function updatePreview() {
      const selectVal = document.getElementById('poemSelect').value;
      const manualVal = document.getElementById('manualInput').value.trim();
      const previewArea = document.getElementById('previewArea');
      const previewText = document.getElementById('previewText');
      const confirmBtn = document.getElementById('confirmBtn');

      let textToShow = manualVal || selectVal;

      if (textToShow) {
        previewText.textContent = textToShow;
        previewArea.style.display = 'block';
        confirmBtn.disabled = false;
      } else {
        previewArea.style.display = 'none';
        confirmBtn.disabled = true;
      }
}
 function confirmYuanwen() {
  const selectVal = document.getElementById('poemSelect').value;
  const manualVal = document.getElementById('manualInput').value.trim();
  const finalText = manualVal || selectVal;

  if (!finalText) {
    alert("è¯·å…ˆé€‰æ‹©æˆ–è¾“å…¥å¤æ–‡ï¼");
    return;
  }

  window.yuanwen = finalText;
  const segments = autoSegment(window.yuanwen);
  
  // æ‰“å°è¯¦ç»†ä¿¡æ¯
  console.log("åŸæ–‡æ€»å­—æ•°:", finalText.length);
  console.log("åˆ†æ®µç»“æœï¼ˆå…±" + segments.length + "æ®µï¼‰:", segments);
  
  alert(`âœ… åŸæ–‡å·²ç¡®è®¤ï¼\næ€»å­—æ•°ï¼š${finalText.length}\nåˆ†ä¸ºï¼š${segments.length} æ®µ\n\nè¯·æŒ‰ F12 æŸ¥çœ‹è¯¦ç»†åˆ†æ®µã€‚`);
}

  // === M2: è‡ªåŠ¨åˆ†æ®µ ===
  /**
 * æ™ºèƒ½åˆ†æ®µï¼šä¿è¯å…¨æ–‡å®Œæ•´ï¼Œæœ€å¤š7æ®µ
 * @param {string} text
 * @returns {string[]}
 */
function autoSegment(text) {
  if (!text || typeof text !== 'string') return [];

  // ç§»é™¤å¤šä½™ç©ºç™½
  text = text.trim();

  // æŒ‰å¥æœ«æ ‡ç‚¹åˆ†å‰²ï¼ˆä¿ç•™æ ‡ç‚¹ï¼‰
  const parts = text.split(/([ã€‚ï¼›ï¼ï¼Ÿ])/).filter(p => p.trim() !== '');
  
  // åˆå¹¶æ ‡ç‚¹åˆ°å‰ä¸€å¥
  const sentences = [];
  for (let i = 0; i < parts.length; i++) {
    if (/[ã€‚ï¼›ï¼ï¼Ÿ]/.test(parts[i]) && sentences.length > 0) {
      sentences[sentences.length - 1] += parts[i];
    } else {
      sentences.push(parts[i]);
    }
  }

  const totalChars = text.length;
  const maxSegments = 7;
  const idealMaxLength = Math.ceil(totalChars / maxSegments); // åŠ¨æ€è®¡ç®—æ¯æ®µç†æƒ³é•¿åº¦
  const maxLength = Math.max(idealMaxLength, 50); // è‡³å°‘50å­—ï¼Œé¿å…å¤ªç¢

  const segments = [];
  let current = '';

  for (const sent of sentences) {
    if ((current + sent).length <= maxLength) {
      current += sent;
    } else {
      if (current) segments.push(current);
      // å¦‚æœå•å¥è¶…é•¿ï¼Œä¹Ÿå…è®¸çªç ´ maxLengthï¼ˆé¿å…åœ¨å¥ä¸­ç¡¬åˆ‡ï¼‰
      current = sent;
    }
    
    // é˜²æ­¢æ— é™å¢é•¿ï¼ˆæç«¯æƒ…å†µï¼‰
    if (segments.length >= maxSegments - 1) {
      // æŠŠå‰©ä½™æ‰€æœ‰å¥å­åˆå¹¶ä¸ºæœ€åä¸€æ®µ
      const remaining = [current, ...sentences.slice(sentences.indexOf(sent) + 1)].join('');
      segments.push(remaining);
      return segments.slice(0, maxSegments);
    }
  }

  if (current) segments.push(current);
  return segments.slice(0, maxSegments);
}

  // === åˆå§‹åŒ–äº‹ä»¶ç›‘å¬ ===
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('poemSelect').addEventListener('change', updatePreview);
    document.getElementById('manualInput').addEventListener('input', updatePreview);
    document.getElementById('confirmBtn').onclick = confirmYuanwen;
  });
</script>
 
</body>
</html>